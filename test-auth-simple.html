<!DOCTYPE html>
<html>
<head>
    <title>Auth Test</title>
    <style>
        body {
            font-family: system-ui;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 0;
        }
        #log {
            background: #f5f5f5;
            padding: 15px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Firebase Auth Test</h1>
    <button id="signin">Sign In with Google</button>
    <button id="signout">Sign Out</button>
    <button id="clear">Clear Log</button>

    <div id="status">Status: Not signed in</div>
    <div id="log"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <script>
        const log = document.getElementById('log');
        const status = document.getElementById('status');

        function addLog(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${time}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDkdbPPZ2pySDOWBhAsSWzkfyYWvR0jlO8",
            authDomain: "reta-tracker.firebaseapp.com",
            projectId: "reta-tracker",
            storageBucket: "reta-tracker.firebasestorage.app",
            messagingSenderId: "273148192362",
            appId: "1:273148192362:web:c3011ac8cf76a3611e0c13"
        };

        addLog('Initializing Firebase...', 'info');
        firebase.initializeApp(firebaseConfig);
        addLog('Firebase initialized', 'success');

        // Check for redirect result
        addLog('Checking for redirect result...', 'info');
        firebase.auth().getRedirectResult()
            .then((result) => {
                if (result.user) {
                    addLog(`✅ Sign-in successful via redirect: ${result.user.email}`, 'success');
                } else {
                    addLog('No redirect result (first load)', 'info');
                }
            })
            .catch((error) => {
                addLog(`❌ Redirect error: ${error.code} - ${error.message}`, 'error');
            });

        // Auth state listener
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                status.textContent = `Status: Signed in as ${user.email}`;
                addLog(`✅ Auth state: Signed in as ${user.email}`, 'success');
            } else {
                status.textContent = 'Status: Not signed in';
                addLog('Auth state: Signed out', 'info');
            }
        });

        // Sign in button
        document.getElementById('signin').addEventListener('click', async () => {
            try {
                addLog('Starting sign-in redirect...', 'info');
                const provider = new firebase.auth.GoogleAuthProvider();
                await firebase.auth().signInWithRedirect(provider);
                addLog('Redirect initiated (page will reload)', 'info');
            } catch (error) {
                addLog(`❌ Sign-in error: ${error.code} - ${error.message}`, 'error');
            }
        });

        // Sign out button
        document.getElementById('signout').addEventListener('click', async () => {
            try {
                await firebase.auth().signOut();
                addLog('✅ Signed out successfully', 'success');
            } catch (error) {
                addLog(`❌ Sign-out error: ${error.message}`, 'error');
            }
        });

        // Clear log button
        document.getElementById('clear').addEventListener('click', () => {
            log.innerHTML = '';
        });
    </script>
</body>
</html>
